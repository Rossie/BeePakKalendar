"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var moment = require("moment");
var settings_service_1 = require("../services/settings.service");
var BehaviorSubject_1 = require("rxjs/BehaviorSubject");
var CalendarService = (function () {
    function CalendarService(settings) {
        this.settings = settings;
        this.locale = 'hu';
        moment.locale(this.locale);
        this.actMonth = moment().date(1); // set current month 1st
        this.monthObservable = new BehaviorSubject_1.BehaviorSubject(this.actMonth);
        this.daysObservable = new BehaviorSubject_1.BehaviorSubject(this.getMonth());
    }
    CalendarService.prototype.stepMonth = function (monthDelta) {
        this.actMonth.add(monthDelta, 'months');
        // this.monthOffset += monthDelta;
        // let now = moment().date(1).add(this.monthOffset, 'months'); // first day of month
        this.monthObservable.next(this.actMonth.clone());
        this.daysObservable.next(this.getMonth());
    };
    CalendarService.prototype.getMonth = function () {
        var result = [];
        // let now = moment().date(1).add(this.monthOffset, 'months'); // first day of month
        var now = this.actMonth.clone();
        var actWeek = now.week();
        var actMonth = now.month();
        var row = 0;
        do {
            // get markers for this day from storage
            var marker = this.settings.getDay(now);
            // insert result object
            result.push({
                row: row,
                col: this.convertDayOfWeek(now.day()),
                day: now.date(),
                date: now.clone(),
                marker: marker
            });
            // next day
            now.add(1, 'day');
            if (actWeek != now.week()) {
                row++;
                actWeek = now.week();
            }
        } while (actMonth == now.month());
        return result;
    };
    CalendarService.prototype.getMonthName = function () {
        // return moment().date(1).add(this.monthOffset, 'months').format('MMMM');
        return this.actMonth.format('MMMM');
    };
    /**
     * Converts JS day of the week where sunday is 0 to sunday = 6 and monday = 0
     * @param day
     */
    CalendarService.prototype.convertDayOfWeek = function (day) {
        var cday = day - 1;
        return cday < 0 ? 6 : cday;
    };
    CalendarService.prototype.selectCalendar = function (imageCalendar) {
        this.imageCalendar = imageCalendar;
    };
    CalendarService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [settings_service_1.SettingsService])
    ], CalendarService);
    return CalendarService;
}());
exports.CalendarService = CalendarService;
exports.markers = [
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-1' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-2' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-3' },
    { icon: String.fromCharCode(0xf1db), cssClass: 'marker-color-1' },
    { icon: String.fromCharCode(0xf1db), cssClass: 'marker-color-2' },
    { icon: String.fromCharCode(0xf1db), cssClass: 'marker-color-3' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-1 small-dot' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-2 small-dot' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-3 small-dot' },
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhbGVuZGFyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsK0JBQWlDO0FBQ2pDLGlFQUE4RDtBQUc5RCx3REFBdUQ7QUFJdkQ7SUFRSSx5QkFDWSxRQUF5QjtRQUF6QixhQUFRLEdBQVIsUUFBUSxDQUFpQjtRQVA3QixXQUFNLEdBQUcsSUFBSSxDQUFDO1FBU2xCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxRQUFRLEdBQUcsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsd0JBQXdCO1FBQzFELElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxpQ0FBZSxDQUFTLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRSxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksaUNBQWUsQ0FBYSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUMzRSxDQUFDO0lBRUQsbUNBQVMsR0FBVCxVQUFVLFVBQVU7UUFDaEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3hDLGtDQUFrQztRQUNsQyxvRkFBb0Y7UUFDcEYsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRCxrQ0FBUSxHQUFSO1FBQ0ksSUFBSSxNQUFNLEdBQWUsRUFBRSxDQUFDO1FBQzVCLG9GQUFvRjtRQUNwRixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxD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QTBCLEVBQUU7SUFDM0UsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsMEJBQTBCLEVBQUU7Q0FDOUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgU2V0dGluZ3NTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvc2V0dGluZ3Muc2VydmljZSdcbmltcG9ydCB7IE1vbWVudCB9IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyBJbWFnZVNvdXJjZSB9IGZyb20gJ3Rucy1jb3JlLW1vZHVsZXMvaW1hZ2Utc291cmNlL2ltYWdlLXNvdXJjZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzL0JlaGF2aW9yU3ViamVjdCc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcy9TdWJqZWN0JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENhbGVuZGFyU2VydmljZSB7XG4gICAgcHVibGljIGltYWdlQ2FsZW5kYXI6IElJbWFnZUNhbGVuZGFyO1xuICAgIHByaXZhdGUgbG9jYWxlID0gJ2h1JztcbiAgICAvLyBwcml2YXRlIG1vbnRoT2Zmc2V0OiBudW1iZXIgPSAwO1xuICAgIHB1YmxpYyBkYXlzT2JzZXJ2YWJsZTogQmVoYXZpb3JTdWJqZWN0PElEYXlJdGVtW10+O1xuICAgIHB1YmxpYyBtb250aE9ic2VydmFibGU6IEJlaGF2aW9yU3ViamVjdDxNb21lbnQ+O1xuICAgIHByaXZhdGUgYWN0TW9udGg6IE1vbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHNldHRpbmdzOiBTZXR0aW5nc1NlcnZpY2VcbiAgICApIHtcbiAgICAgICAgbW9tZW50LmxvY2FsZSh0aGlzLmxvY2FsZSk7XG4gICAgICAgIHRoaXMuYWN0TW9udGggPSBtb21lbnQoKS5kYXRlKDEpOyAvLyBzZXQgY3VycmVudCBtb250aCAxc3RcbiAgICAgICAgdGhpcy5tb250aE9ic2VydmFibGUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PE1vbWVudD4odGhpcy5hY3RNb250aCk7XG4gICAgICAgIHRoaXMuZGF5c09ic2VydmFibGUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PElEYXlJdGVtW10+KHRoaXMuZ2V0TW9udGgoKSk7XG4gICAgfVxuXG4gICAgc3RlcE1vbnRoKG1vbnRoRGVsdGEpIHtcbiAgICAgICAgdGhpcy5hY3RNb250aC5hZGQobW9udGhEZWx0YSwgJ21vbnRocycpO1xuICAgICAgICAvLyB0aGlzLm1vbnRoT2Zmc2V0ICs9IG1vbnRoRGVsdGE7XG4gICAgICAgIC8vIGxldCBub3cgPSBtb21lbnQoKS5kYXRlKDEpLmFkZCh0aGlzLm1vbnRoT2Zmc2V0LCAnbW9udGhzJyk7IC8vIGZpcnN0IGRheSBvZiBtb250aFxuICAgICAgICB0aGlzLm1vbnRoT2JzZXJ2YWJsZS5uZXh0KHRoaXMuYWN0TW9udGguY2xvbmUoKSk7XG4gICAgICAgIHRoaXMuZGF5c09ic2VydmFibGUubmV4dCh0aGlzLmdldE1vbnRoKCkpO1xuICAgIH1cblxuICAgIGdldE1vbnRoKCk6IGFueVtdIHtcbiAgICAgICAgdmFyIHJlc3VsdDogSURheUl0ZW1bXSA9IFtdO1xuICAgICAgICAvLyBsZXQgbm93ID0gbW9tZW50KCkuZGF0ZSgxKS5hZGQodGhpcy5tb250aE9mZnNldCwgJ21vbnRocycpOyAvLyBmaXJzdCBkYXkgb2YgbW9udGhcbiAgICAgICAgbGV0IG5vdyA9IHRoaXMuYWN0TW9udGguY2xvbmUoKTtcbiAgICAgICAgbGV0IGFjdFdlZWsgPSBub3cud2VlaygpO1xuICAgICAgICBsZXQgYWN0TW9udGggPSBub3cubW9udGgoKTtcbiAgICAgICAgbGV0IHJvdyA9IDA7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIC8vIGdldCBtYXJrZXJzIGZvciB0aGlzIGRheSBmcm9tIHN0b3JhZ2VcbiAgICAgICAgICAgIGxldCBtYXJrZXI6SURheU1hcmtlciA9IHRoaXMuc2V0dGluZ3MuZ2V0RGF5KG5vdyk7XG4gICAgICAgICAgICAvLyBpbnNlcnQgcmVzdWx0IG9iamVjdFxuICAgICAgICAgICAgcmVzdWx0LnB1c2goeyBcbiAgICAgICAgICAgICAgICByb3c6IHJvdywgXG4gICAgICAgICAgICAgICAgY29sOiB0aGlzLmNvbnZlcnREYXlPZldlZWsobm93LmRheSgpKSwgXG4gICAgICAgICAgICAgICAgZGF5OiBub3cuZGF0ZSgpLFxuICAgICAgICAgICAgICAgIGRhdGU6IG5vdy5jbG9uZSgpLFxuICAgICAgICAgICAgICAgIG1hcmtlcjogbWFya2VyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIG5leHQgZGF5XG4gICAgICAgICAgICBub3cuYWRkKDEsICdkYXknKTtcblxuICAgICAgICAgICAgaWYgKGFjdFdlZWsgIT0gbm93LndlZWsoKSkgeyAvLyBpbmNyZW1lbnQgcm93IGlmIHdlZWsgZGlmZmVyZW50IChpbXBvcnRhbnQgYXJvdW5kIGRlYyAzMS4pXG4gICAgICAgICAgICAgICAgcm93Kys7XG4gICAgICAgICAgICAgICAgYWN0V2VlayA9IG5vdy53ZWVrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gd2hpbGUgKGFjdE1vbnRoID09IG5vdy5tb250aCgpKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGdldE1vbnRoTmFtZSgpOiBzdHJpbmcge1xuICAgICAgICAvLyByZXR1cm4gbW9tZW50KCkuZGF0ZSgxKS5hZGQodGhpcy5tb250aE9mZnNldCwgJ21vbnRocycpLmZvcm1hdCgnTU1NTScpO1xuICAgICAgICByZXR1cm4gdGhpcy5hY3RNb250aC5mb3JtYXQoJ01NTU0nKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBKUyBkYXkgb2YgdGhlIHdlZWsgd2hlcmUgc3VuZGF5IGlzIDAgdG8gc3VuZGF5ID0gNiBhbmQgbW9uZGF5ID0gMFxuICAgICAqIEBwYXJhbSBkYXkgXG4gICAgICovXG4gICAgcHJpdmF0ZSBjb252ZXJ0RGF5T2ZXZWVrKGRheTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IGNkYXkgPSBkYXkgLSAxO1xuICAgICAgICByZXR1cm4gY2RheSA8IDAgPyA2IDogY2RheTtcbiAgICB9XG5cbiAgICBzZWxlY3RDYWxlbmRhcihpbWFnZUNhbGVuZGFyOklJbWFnZUNhbGVuZGFyKSB7XG4gICAgICAgIHRoaXMuaW1hZ2VDYWxlbmRhciA9IGltYWdlQ2FsZW5kYXI7XG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElEYXlJdGVtIHtcbiAgICByb3c6IG51bWJlcjtcbiAgICBjb2w6IG51bWJlcjtcbiAgICBkYXk6IG51bWJlcjtcbiAgICBkYXRlOiBNb21lbnQ7XG4gICAgbWFya2VyPzogSURheU1hcmtlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJRGF5TWFya2VyIHtcbiAgICBpY29uOiBzdHJpbmc7XG4gICAgY3NzQ2xhc3M6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJSW1hZ2VDYWxlbmRhciB7XG4gICAgaW1hZ2VGaWxlOiBzdHJpbmc7XG4gICAgY2FsZW5kYXJMZWZ0OiBudW1iZXI7XG4gICAgY2FsZW5kYXJUb3A6IG51bWJlcjtcbiAgICBjYWxlbmRhclNjYWxlOiBudW1iZXI7XG4gICAgY3JlYXRlZE9uOiBudW1iZXI7XG4gICAgbGFzdE1vbnRoOiBudW1iZXI7XG4gICAgLy8gaW1hZ2VTb3VyY2U/OiBJbWFnZVNvdXJjZTtcbn1cblxuZXhwb3J0IHZhciBtYXJrZXJzOiBJRGF5TWFya2VyW10gPSBbXG4gICAgeyBpY29uOiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZjExMSksIGNzc0NsYXNzOiAnbWFya2VyLWNvbG9yLTEnIH0sXG4gICAgeyBpY29uOiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZjExMSksIGNzc0NsYXNzOiAnbWFya2VyLWNvbG9yLTInIH0sXG4gICAgeyBpY29uOiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZjExMSksIGNzc0NsYXNzOiAnbWFya2VyLWNvbG9yLTMnIH0sXG4gICAgeyBpY29uOiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZjFkYiksIGNzc0NsYXNzOiAnbWFya2VyLWNvbG9yLTEnIH0sXG4gICAgeyBpY29uOiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZjFkYiksIGNzc0NsYXNzOiAnbWFya2VyLWNvbG9yLTInIH0sXG4gICAgeyBpY29uOiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZjFkYiksIGNzc0NsYXNzOiAnbWFya2VyLWNvbG9yLTMnIH0sXG4gICAgeyBpY29uOiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZjExMSksIGNzc0NsYXNzOiAnbWFya2VyLWNvbG9yLTEgc21hbGwtZG90JyB9LFxuICAgIHsgaWNvbjogU3RyaW5nLmZyb21DaGFyQ29kZSgweGYxMTEpLCBjc3NDbGFzczogJ21hcmtlci1jb2xvci0yIHNtYWxsLWRvdCcgfSxcbiAgICB7IGljb246IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhmMTExKSwgY3NzQ2xhc3M6ICdtYXJrZXItY29sb3ItMyBzbWFsbC1kb3QnIH0sXG5dO1xuXG4iXX0=