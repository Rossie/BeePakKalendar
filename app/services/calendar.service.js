"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var moment = require("moment");
var settings_service_1 = require("../services/settings.service");
var BehaviorSubject_1 = require("rxjs/BehaviorSubject");
var CalendarService = (function () {
    function CalendarService(settings) {
        this.settings = settings;
        this.locale = 'hu';
        moment.locale(this.locale);
        this.actMonth = moment().date(1); // set current month 1st
        this.monthObservable = new BehaviorSubject_1.BehaviorSubject(this.actMonth);
        this.daysObservable = new BehaviorSubject_1.BehaviorSubject(this.getMonth());
    }
    CalendarService.prototype.stepMonth = function (monthDelta) {
        this.actMonth.add(monthDelta, 'months');
        this.monthObservable.next(this.actMonth.clone());
        this.daysObservable.next(this.getMonth());
    };
    CalendarService.prototype.getMonth = function () {
        var result = [];
        // let now = moment().date(1).add(this.monthOffset, 'months'); // first day of month
        var now = this.actMonth.clone();
        var actWeek = now.week();
        var actMonth = now.month();
        var row = 0;
        do {
            // get markers for this day from storage
            var marker = this.settings.getDay(now);
            // insert result object
            result.push({
                row: row,
                col: this.convertDayOfWeek(now.day()),
                day: now.date(),
                date: now.clone(),
                marker: marker
            });
            // next day
            now.add(1, 'day');
            if (actWeek != now.week()) {
                row++;
                actWeek = now.week();
            }
        } while (actMonth == now.month());
        return result;
    };
    CalendarService.prototype.getMonthName = function () {
        return this.actMonth.format('MMMM');
    };
    /**
     * Converts JS day of the week where sunday is 0 to sunday = 6 and monday = 0
     * @param day
     */
    CalendarService.prototype.convertDayOfWeek = function (day) {
        var cday = day - 1;
        return cday < 0 ? 6 : cday;
    };
    CalendarService.prototype.selectCalendar = function (imageCalendar) {
        this.imageCalendar = imageCalendar;
    };
    CalendarService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [settings_service_1.SettingsService])
    ], CalendarService);
    return CalendarService;
}());
exports.CalendarService = CalendarService;
exports.markers = [
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-1' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-2' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-3' },
    { icon: String.fromCharCode(0xf1db), cssClass: 'marker-color-1' },
    { icon: String.fromCharCode(0xf1db), cssClass: 'marker-color-2' },
    { icon: String.fromCharCode(0xf1db), cssClass: 'marker-color-3' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-1 small-dot' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-2 small-dot' },
    { icon: String.fromCharCode(0xf111), cssClass: 'marker-color-3 small-dot' },
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhbGVuZGFyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsK0JBQWlDO0FBQ2pDLGlFQUE4RDtBQUc5RCx3REFBdUQ7QUFJdkQ7SUFPSSx5QkFDWSxRQUF5QjtRQUF6QixhQUFRLEdBQVIsUUFBUSxDQUFpQjtRQU43QixXQUFNLEdBQUcsSUFBSSxDQUFDO1FBUWxCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxRQUFRLEdBQUcsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsd0JBQXdCO1FBQzFELElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxpQ0FBZSxDQUFTLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRSxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksaUNBQWUsQ0FBYSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUMzRSxDQUFDO0lBRUQsbUNBQVMsR0FBVCxVQUFVLFVBQVU7UUFDaEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsa0NBQVEsR0FBUjtRQUNJLElBQUksTUFBTSxHQUFlLEVBQUUsQ0FBQztRQUM1QixvRkFBb0Y7UUFDcEYsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNoQyxJQUFJLE9BQU8sR0FBRyxH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LFlBQVksQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsMEJBQTBCLEVBQUU7Q0FDOUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgU2V0dGluZ3NTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvc2V0dGluZ3Muc2VydmljZSdcbmltcG9ydCB7IE1vbWVudCB9IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyBJbWFnZVNvdXJjZSB9IGZyb20gJ3Rucy1jb3JlLW1vZHVsZXMvaW1hZ2Utc291cmNlL2ltYWdlLXNvdXJjZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzL0JlaGF2aW9yU3ViamVjdCc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcy9TdWJqZWN0JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENhbGVuZGFyU2VydmljZSB7XG4gICAgcHVibGljIGltYWdlQ2FsZW5kYXI6IElJbWFnZUNhbGVuZGFyO1xuICAgIHByaXZhdGUgbG9jYWxlID0gJ2h1JztcbiAgICBwdWJsaWMgZGF5c09ic2VydmFibGU6IEJlaGF2aW9yU3ViamVjdDxJRGF5SXRlbVtdPjtcbiAgICBwdWJsaWMgbW9udGhPYnNlcnZhYmxlOiBCZWhhdmlvclN1YmplY3Q8TW9tZW50PjtcbiAgICBwcml2YXRlIGFjdE1vbnRoOiBNb21lbnQ7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBzZXR0aW5nczogU2V0dGluZ3NTZXJ2aWNlXG4gICAgKSB7XG4gICAgICAgIG1vbWVudC5sb2NhbGUodGhpcy5sb2NhbGUpO1xuICAgICAgICB0aGlzLmFjdE1vbnRoID0gbW9tZW50KCkuZGF0ZSgxKTsgLy8gc2V0IGN1cnJlbnQgbW9udGggMXN0XG4gICAgICAgIHRoaXMubW9udGhPYnNlcnZhYmxlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxNb21lbnQ+KHRoaXMuYWN0TW9udGgpO1xuICAgICAgICB0aGlzLmRheXNPYnNlcnZhYmxlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxJRGF5SXRlbVtdPih0aGlzLmdldE1vbnRoKCkpO1xuICAgIH1cblxuICAgIHN0ZXBNb250aChtb250aERlbHRhKSB7XG4gICAgICAgIHRoaXMuYWN0TW9udGguYWRkKG1vbnRoRGVsdGEsICdtb250aHMnKTtcbiAgICAgICAgdGhpcy5tb250aE9ic2VydmFibGUubmV4dCh0aGlzLmFjdE1vbnRoLmNsb25lKCkpO1xuICAgICAgICB0aGlzLmRheXNPYnNlcnZhYmxlLm5leHQodGhpcy5nZXRNb250aCgpKTtcbiAgICB9XG5cbiAgICBnZXRNb250aCgpOiBhbnlbXSB7XG4gICAgICAgIHZhciByZXN1bHQ6IElEYXlJdGVtW10gPSBbXTtcbiAgICAgICAgLy8gbGV0IG5vdyA9IG1vbWVudCgpLmRhdGUoMSkuYWRkKHRoaXMubW9udGhPZmZzZXQsICdtb250aHMnKTsgLy8gZmlyc3QgZGF5IG9mIG1vbnRoXG4gICAgICAgIGxldCBub3cgPSB0aGlzLmFjdE1vbnRoLmNsb25lKCk7XG4gICAgICAgIGxldCBhY3RXZWVrID0gbm93LndlZWsoKTtcbiAgICAgICAgbGV0IGFjdE1vbnRoID0gbm93Lm1vbnRoKCk7XG4gICAgICAgIGxldCByb3cgPSAwO1xuICAgICAgICBkbyB7XG4gICAgICAgICAgICAvLyBnZXQgbWFya2VycyBmb3IgdGhpcyBkYXkgZnJvbSBzdG9yYWdlXG4gICAgICAgICAgICBsZXQgbWFya2VyOklEYXlNYXJrZXIgPSB0aGlzLnNldHRpbmdzLmdldERheShub3cpO1xuICAgICAgICAgICAgLy8gaW5zZXJ0IHJlc3VsdCBvYmplY3RcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHsgXG4gICAgICAgICAgICAgICAgcm93OiByb3csIFxuICAgICAgICAgICAgICAgIGNvbDogdGhpcy5jb252ZXJ0RGF5T2ZXZWVrKG5vdy5kYXkoKSksIFxuICAgICAgICAgICAgICAgIGRheTogbm93LmRhdGUoKSxcbiAgICAgICAgICAgICAgICBkYXRlOiBub3cuY2xvbmUoKSxcbiAgICAgICAgICAgICAgICBtYXJrZXI6IG1hcmtlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBuZXh0IGRheVxuICAgICAgICAgICAgbm93LmFkZCgxLCAnZGF5Jyk7XG5cbiAgICAgICAgICAgIGlmIChhY3RXZWVrICE9IG5vdy53ZWVrKCkpIHsgLy8gaW5jcmVtZW50IHJvdyBpZiB3ZWVrIGRpZmZlcmVudCAoaW1wb3J0YW50IGFyb3VuZCBkZWMgMzEuKVxuICAgICAgICAgICAgICAgIHJvdysrO1xuICAgICAgICAgICAgICAgIGFjdFdlZWsgPSBub3cud2VlaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IHdoaWxlIChhY3RNb250aCA9PSBub3cubW9udGgoKSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBnZXRNb250aE5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0TW9udGguZm9ybWF0KCdNTU1NJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgSlMgZGF5IG9mIHRoZSB3ZWVrIHdoZXJlIHN1bmRheSBpcyAwIHRvIHN1bmRheSA9IDYgYW5kIG1vbmRheSA9IDBcbiAgICAgKiBAcGFyYW0gZGF5IFxuICAgICAqL1xuICAgIHByaXZhdGUgY29udmVydERheU9mV2VlayhkYXk6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIGxldCBjZGF5ID0gZGF5IC0gMTtcbiAgICAgICAgcmV0dXJuIGNkYXkgPCAwID8gNiA6IGNkYXk7XG4gICAgfVxuXG4gICAgc2VsZWN0Q2FsZW5kYXIoaW1hZ2VDYWxlbmRhcjpJSW1hZ2VDYWxlbmRhcikge1xuICAgICAgICB0aGlzLmltYWdlQ2FsZW5kYXIgPSBpbWFnZUNhbGVuZGFyO1xuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJRGF5SXRlbSB7XG4gICAgcm93OiBudW1iZXI7XG4gICAgY29sOiBudW1iZXI7XG4gICAgZGF5OiBudW1iZXI7XG4gICAgZGF0ZTogTW9tZW50O1xuICAgIG1hcmtlcj86IElEYXlNYXJrZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSURheU1hcmtlciB7XG4gICAgaWNvbjogc3RyaW5nO1xuICAgIGNzc0NsYXNzOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUltYWdlQ2FsZW5kYXIge1xuICAgIGltYWdlRmlsZTogc3RyaW5nO1xuICAgIGNhbGVuZGFyTGVmdDogbnVtYmVyO1xuICAgIGNhbGVuZGFyVG9wOiBudW1iZXI7XG4gICAgY2FsZW5kYXJTY2FsZTogbnVtYmVyO1xuICAgIGNyZWF0ZWRPbjogbnVtYmVyO1xuICAgIGxhc3RNb250aDogbnVtYmVyO1xuICAgIC8vIGltYWdlU291cmNlPzogSW1hZ2VTb3VyY2U7XG59XG5cbmV4cG9ydCB2YXIgbWFya2VyczogSURheU1hcmtlcltdID0gW1xuICAgIHsgaWNvbjogU3RyaW5nLmZyb21DaGFyQ29kZSgweGYxMTEpLCBjc3NDbGFzczogJ21hcmtlci1jb2xvci0xJyB9LFxuICAgIHsgaWNvbjogU3RyaW5nLmZyb21DaGFyQ29kZSgweGYxMTEpLCBjc3NDbGFzczogJ21hcmtlci1jb2xvci0yJyB9LFxuICAgIHsgaWNvbjogU3RyaW5nLmZyb21DaGFyQ29kZSgweGYxMTEpLCBjc3NDbGFzczogJ21hcmtlci1jb2xvci0zJyB9LFxuICAgIHsgaWNvbjogU3RyaW5nLmZyb21DaGFyQ29kZSgweGYxZGIpLCBjc3NDbGFzczogJ21hcmtlci1jb2xvci0xJyB9LFxuICAgIHsgaWNvbjogU3RyaW5nLmZyb21DaGFyQ29kZSgweGYxZGIpLCBjc3NDbGFzczogJ21hcmtlci1jb2xvci0yJyB9LFxuICAgIHsgaWNvbjogU3RyaW5nLmZyb21DaGFyQ29kZSgweGYxZGIpLCBjc3NDbGFzczogJ21hcmtlci1jb2xvci0zJyB9LFxuICAgIHsgaWNvbjogU3RyaW5nLmZyb21DaGFyQ29kZSgweGYxMTEpLCBjc3NDbGFzczogJ21hcmtlci1jb2xvci0xIHNtYWxsLWRvdCcgfSxcbiAgICB7IGljb246IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhmMTExKSwgY3NzQ2xhc3M6ICdtYXJrZXItY29sb3ItMiBzbWFsbC1kb3QnIH0sXG4gICAgeyBpY29uOiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZjExMSksIGNzc0NsYXNzOiAnbWFya2VyLWNvbG9yLTMgc21hbGwtZG90JyB9LFxuXTtcblxuIl19